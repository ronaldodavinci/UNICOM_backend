basePath: /
definitions:
  dto.CreatePostDTO:
    properties:
      categoryIds:
        items:
          type: string
        type: array
      media:
        items:
          type: string
        type: array
      org_of_content:
        type: string
      postAs:
        allOf:
        - $ref: '#/definitions/dto.PostAs'
        description: เดิมคือ rolePath
      postText:
        type: string
      visibility:
        allOf:
        - $ref: '#/definitions/dto.Visibility'
        description: เดิมคือ roleIds
    required:
    - postAs
    - postText
    - visibility
    type: object
  dto.ErrorResponse:
    properties:
      error:
        example: invalid body
        type: string
    type: object
  dto.EventReport:
    properties:
      event_id:
        type: string
      event_topic:
        type: string
      schedules:
        items:
          $ref: '#/definitions/dto.EventScheduleReport'
        type: array
    type: object
  dto.EventRequestDTO:
    properties:
      description:
        type: string
      max_participation:
        type: integer
      node_id:
        type: string
      org_of_content:
        type: string
      posted_as:
        $ref: '#/definitions/models.PostedAs'
      schedules:
        items:
          properties:
            date:
              type: string
            description:
              type: string
            location:
              type: string
            time_end:
              type: string
            time_start:
              type: string
          type: object
        type: array
      status:
        type: string
      topic:
        type: string
      visibility:
        $ref: '#/definitions/models.Visibility'
    type: object
  dto.EventScheduleReport:
    properties:
      date:
        type: string
      end_time:
        type: string
      start_time:
        type: string
    type: object
  dto.MembershipProfileDTO:
    properties:
      membership_name:
        description: e.g., Position Display Name
        type: string
      org_unit:
        $ref: '#/definitions/models.OrgUnitNode'
      policies:
        $ref: '#/definitions/models.Policy'
      position:
        $ref: '#/definitions/models.Position'
    type: object
  dto.OrgUnitDTO:
    properties:
      name:
        type: string
      parent_path:
        type: string
      slug:
        type: string
      type:
        type: string
    type: object
  dto.OrgUnitReport:
    properties:
      name:
        type: string
      org_id:
        type: string
      org_path:
        type: string
      short_name:
        type: string
    type: object
  dto.OrgUnitTree:
    properties:
      children:
        items:
          $ref: '#/definitions/dto.OrgUnitTree'
        type: array
      label:
        type: string
      org_path:
        type: string
      short_name:
        type: string
      type:
        type: string
    type: object
  dto.PolicyUpdateDTO:
    properties:
      actions:
        items:
          type: string
        type: array
      enabled:
        type: boolean
      key:
        type: string
      org_path:
        type: string
    type: object
  dto.PositionCreateDTO:
    properties:
      constraints:
        $ref: '#/definitions/models.Constraints'
      display:
        additionalProperties:
          type: string
        type: object
      key:
        type: string
      policy:
        properties:
          actions:
            items:
              type: string
            type: array
          enabled:
            type: boolean
          type:
            description: '"exact" or "subtree"'
            type: string
        type: object
      rank:
        type: integer
      scope:
        $ref: '#/definitions/models.Scope'
      status:
        type: string
    type: object
  dto.PostAs:
    properties:
      label:
        description: e.g., "Head • SMO"
        type: string
      org_path:
        type: string
      position_key:
        type: string
    type: object
  dto.PostResponse:
    properties:
      categoryIds:
        example:
        - '[''68bd8d30b98a8dce0eab0db6'''
        - '''68bd8d30b98a8dce0eab0db7'']'
        items:
          type: string
        type: array
      commentCount:
        example: 0
        type: integer
      createdAt:
        example: "2025-09-07T13:47:47Z"
        type: string
      hashtag:
        items:
          type: string
        type: array
      likeCount:
        example: 0
        type: integer
      media:
        example:
        - '[''ttp://45.144.166.252:46602/uploads/cat.png'']'
        items:
          type: string
        type: array
      name:
        example: JY
        type: string
      org_of_content:
        description: this content belongs to which org (org_path)
        type: string
      postAs:
        allOf:
        - $ref: '#/definitions/dto.PostAs'
        description: which role is posting this
      postText:
        example: สวัสดี KU!
        type: string
      status:
        example: active
        type: string
      updatedAt:
        example: "2025-09-07T13:47:47Z"
        type: string
      userId:
        example: 66c6248b98c56c39f018e7d2
        type: string
      username:
        example: jy_smo
        type: string
      visibility:
        allOf:
        - $ref: '#/definitions/dto.Visibility'
        description: which roles can see this post, array of roleIds
    type: object
  dto.UpdatePostFullDTO:
    properties:
      categoryIds:
        items:
          type: string
        type: array
      org_of_content:
        type: string
      pictureUrl:
        items:
          type: string
        type: array
      postAs:
        $ref: '#/definitions/dto.PostAs'
      postText:
        type: string
      status:
        type: string
      videoUrl:
        items:
          type: string
        type: array
      visibility:
        $ref: '#/definitions/dto.Visibility'
    required:
    - postAs
    - postText
    - visibility
    type: object
  dto.UserProfileDTO:
    properties:
      advisor_id:
        type: string
      email:
        type: string
      firstname:
        type: string
      gender:
        type: string
      id:
        type: string
      lastname:
        type: string
      memberships:
        items:
          $ref: '#/definitions/dto.MembershipProfileDTO'
        type: array
      student_id:
        type: string
      thaiprefix:
        type: string
      type_person:
        type: string
    type: object
  dto.Visibility:
    properties:
      access:
        type: string
      audience:
        items:
          type: string
        type: array
    type: object
  models.AudienceItem:
    properties:
      org_path:
        type: string
      scope:
        description: '"exact" | "subtree"'
        type: string
    type: object
  models.Constraints:
    properties:
      exclusive_per_org:
        type: boolean
    type: object
  models.LoginRequest:
    properties:
      email:
        type: string
      password:
        type: string
    type: object
  models.MembershipRequestDTO:
    properties:
      active:
        type: boolean
      org_path:
        type: string
      position_key:
        type: string
      user_id:
        type: string
    type: object
  models.OrgUnitNode:
    properties:
      ancestors:
        items:
          type: string
        type: array
      created_at:
        type: string
      depth:
        type: integer
      id:
        type: string
      name:
        type: string
      org_path:
        type: string
      parent_path:
        type: string
      shortname:
        type: string
      slug:
        type: string
      status:
        type: string
      type:
        type: string
      updated_at:
        type: string
    type: object
  models.Policy:
    properties:
      _id:
        type: string
      actions:
        items:
          type: string
        type: array
      created_at:
        type: string
      enabled:
        type: boolean
      org_prefix:
        type: string
      position_key:
        type: string
      scope:
        description: exact (control only the same orgpath) & subtree (control orgpath
          under this path)
        type: string
      updatedAt:
        type: string
    type: object
  models.Position:
    properties:
      _id:
        type: string
      constraints:
        $ref: '#/definitions/models.Constraints'
      createdAt:
        type: string
      display:
        additionalProperties:
          type: string
        type: object
      key:
        type: string
      rank:
        type: integer
      scope:
        $ref: '#/definitions/models.Scope'
      status:
        type: string
      updatedAt:
        type: string
    type: object
  models.Post:
    properties:
      CommentCount:
        type: integer
      createdAt:
        type: string
      hashtag:
        items:
          type: string
        type: array
      id:
        type: string
      likeCount:
        type: integer
      media:
        items:
          type: string
        type: array
      positionId:
        type: string
      postText:
        type: string
      rolePathId:
        type: string
      status:
        description: active, deleted
        type: string
      tags:
        type: string
      updatedAt:
        type: string
      userId:
        type: string
    type: object
  models.PostedAs:
    properties:
      label:
        type: string
      org_path:
        type: string
      position_key:
        type: string
    type: object
  models.RegisterRequest:
    properties:
      advisor_id:
        type: string
      email:
        type: string
      firstname:
        type: string
      gender:
        type: string
      lastname:
        type: string
      password:
        type: string
      student_id:
        type: string
      thaiprefix:
        type: string
      type_person:
        type: string
    type: object
  models.Scope:
    properties:
      inherit:
        type: boolean
      org_path:
        type: string
    type: object
  models.Visibility:
    properties:
      access:
        type: string
      allow_user_ids:
        items:
          type: string
        type: array
      audience:
        items:
          $ref: '#/definitions/models.AudienceItem'
        type: array
      deny_user_ids:
        items:
          type: string
        type: array
      exclude_positions:
        items:
          type: string
        type: array
      include_positions:
        items:
          type: string
        type: array
    type: object
host: localhost:8000
info:
  contact: {}
  description: This is a sample server for user management.
  title: Fiber MongoDB API
  version: "1.0"
paths:
  /event:
    get:
      description: Return all events that the current user can see
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get all visible events
      tags:
      - events
    post:
      consumes:
      - application/json
      description: Create an event with schedules
      parameters:
      - description: Event payload
        in: body
        name: event
        required: true
        schema:
          $ref: '#/definitions/dto.EventRequestDTO'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.EventReport'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Create new event
      tags:
      - events
  /event/{id}:
    delete:
      description: Mark event as hidden
      parameters:
      - description: Event ID
        in: path
        name: id
        required: true
        type: string
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Soft delete event
      tags:
      - events
  /login:
    post:
      consumes:
      - application/json
      description: Authenticate user and return JWT token
      parameters:
      - description: Login Request
        in: body
        name: loginRequest
        required: true
        schema:
          $ref: '#/definitions/models.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: User and access token
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid request body
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Invalid credentials
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Database or token error
          schema:
            additionalProperties: true
            type: object
      summary: Login user
      tags:
      - auth
  /memberships:
    post:
      consumes:
      - application/json
      description: Assigns a user to an organization and position
      parameters:
      - description: Membership data
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.MembershipRequestDTO'
      produces:
      - application/json
      responses:
        "200":
          description: membership created
          schema:
            $ref: '#/definitions/models.MembershipRequestDTO'
        "400":
          description: invalid body
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: internal server error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Create a new membership
      tags:
      - Memberships
  /memberships/{id}:
    patch:
      consumes:
      - application/json
      description: Set membership active=false by id
      parameters:
      - description: Membership ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Deactivate membership
      tags:
      - memberships
  /memberships/users:
    get:
      consumes:
      - application/json
      description: Returns active memberships at exact org_path, joined with basic
        user info
      parameters:
      - description: Organization path
        in: query
        name: org_path
        required: true
        type: string
      - description: 'active|all (default: active)'
        in: query
        name: active
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: List memberships at an org with user details
      tags:
      - memberships
  /org/units:
    post:
      consumes:
      - application/json
      description: Creates a new organization unit node in the hierarchy
      parameters:
      - description: Org Unit Data
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/dto.OrgUnitDTO'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.OrgUnitReport'
        "400":
          description: invalid request body
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: internal server error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Create a new organization unit
      tags:
      - Org Units
  /org/units/tree:
    get:
      consumes:
      - application/json
      description: Returns an organization tree starting from a given path and optional
        depth
      parameters:
      - description: Starting org path
        in: query
        name: start
        required: true
        type: string
      - description: Depth of tree to fetch
        in: query
        name: depth
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/dto.OrgUnitTree'
            type: array
        "400":
          description: invalid query parameters
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: internal server error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get organization tree
      tags:
      - Org Units
  /policies:
    delete:
      consumes:
      - application/json
      description: Delete policies by org_prefix and optional position_key
      parameters:
      - description: Org prefix
        in: query
        name: org_prefix
        required: true
        type: string
      - description: Position key
        in: query
        name: position_key
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Delete policies
      tags:
      - Policies
    get:
      consumes:
      - application/json
      description: Returns policies, optionally filtered by org_prefix and/or position_key
      parameters:
      - description: Org prefix filter
        in: query
        name: org_prefix
        type: string
      - description: Position key filter
        in: query
        name: position_key
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: List policies
      tags:
      - Policies
    put:
      consumes:
      - application/json
      description: 'Updates policy actions for a position. Only the actions sent will
        be kept. Supported actions:'
      parameters:
      - description: Policy update data
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/dto.PolicyUpdateDTO'
      produces:
      - application/json
      responses:
        "201":
          description: policy updated successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: invalid body
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: no permission to manage this policy
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: target policy not found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: failed to update policy
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Update Policy actions
      tags:
      - Policies
  /positions:
    get:
      consumes:
      - application/json
      description: Returns a list of positions
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              items:
                type: string
              type: array
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties: true
            type: object
      summary: List positions
      tags:
      - positions
    post:
      consumes:
      - application/json
      description: 'Create a new position and attach a policy. Policy actions support
        only:'
      parameters:
      - description: Position & Policy data
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/dto.PositionCreateDTO'
      produces:
      - application/json
      responses:
        "201":
          description: position created successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: invalid body
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: internal server error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Create a new Position with Policy
      tags:
      - Positions
  /posts:
    post:
      consumes:
      - application/json
      description: Create a new post with categories, visibility and media URLs
      parameters:
      - description: Bearer {token}
        in: header
        name: Authorization
        required: true
        type: string
      - description: Post payload
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/dto.CreatePostDTO'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.PostResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Create a post
      tags:
      - posts
  /posts/{id}:
    delete:
      description: เปลี่ยนสถานะโพสต์จาก active เป็น inactive (soft delete)
      parameters:
      - description: Post ID (hex)
        in: path
        name: id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: 'Soft delete post (status: active -> inactive)'
      tags:
      - posts
    put:
      consumes:
      - application/json
      description: Update post text, medias, categories, visibility, and posted-as.
        Owner can edit content; admin/root can also change status.
      parameters:
      - description: Bearer {token}
        in: header
        name: Authorization
        required: true
        type: string
      - description: Post ID (hex)
        in: path
        name: id
        required: true
        type: string
      - description: Full update payload
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/dto.UpdatePostFullDTO'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Post'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Update a post (full replace of editable fields)
      tags:
      - posts
  /posts/{post_id}:
    get:
      consumes:
      - application/json
      description: Return post detail (user, position, org path, visibility, categories,
        likes count, etc.)
      parameters:
      - description: Post ID (hex)
        in: path
        name: post_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.PostResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get a post detail
      tags:
      - posts
  /register:
    post:
      consumes:
      - application/json
      description: Create a new user account with hashed password
      parameters:
      - description: Register Request
        in: body
        name: registerRequest
        required: true
        schema:
          $ref: '#/definitions/models.RegisterRequest'
      produces:
      - application/json
      responses:
        "201":
          description: User registered successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid request body or email already exists
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Failed to create user
          schema:
            additionalProperties: true
            type: object
      summary: Register a new user
      tags:
      - auth
  /user/{field}/{value}:
    get:
      description: Get a user by ID, firstname, lastname, etc.
      parameters:
      - description: Search value
        in: path
        name: value
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties: true
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties: true
            type: object
      summary: Get user by field
      tags:
      - users
  /users:
    get:
      description: Returns all users in database
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties: true
            type: object
      summary: Get all users
      tags:
      - users
  /users/{id}:
    delete:
      description: Delete a user with given ID
      parameters:
      - description: User ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties: true
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties: true
            type: object
      summary: Delete user by ID
      tags:
      - users
  /users/myprofile:
    get:
      description: Returns the profile of the currently authenticated user
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.UserProfileDTO'
        "401":
          description: unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: internal server error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get my profile
      tags:
      - Users
  /users/profile:
    get:
      description: Returns profile information for a given user ID via query param
        `id`
      parameters:
      - description: User ID
        in: query
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.UserProfileDTO'
        "400":
          description: missing id
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: internal server error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get user profile by ID (query)
      tags:
      - Users
  /users/profile/{id}:
    get:
      description: Returns profile information for a given user ID
      parameters:
      - description: User ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.UserProfileDTO'
        "404":
          description: user not found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: internal server error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get user profile by ID
      tags:
      - Users
swagger: "2.0"
